(function(f){function u(C){function B(){}B.prototype=C||this;return new B()}var h={};h.settings={enableGeoIP:true,acceptedCards:["visa","mastercard","discover","american_express"],oneErrorPerField:true};h.version="2.1.3";h.dom={};h.Error={toString:function(){return"RecurlyJS Error: "+this.message}};h.raiseError=function(B){var C=u(h.Error);C.message=B;throw C};h.config=function(B){f.extend(true,h.settings,B);if(!B.baseURL){h.settings.baseURL="https://api.recurly.com/jsonp/";var C=h.settings.subdomain||h.raiseError("company subdomain not configured");h.settings.baseURL+=C+"/"}};function t(C,B){if(C==1){return B.substr(0,B.length-1)}return""+C+" "+B}(h.Cost=function(B){this._cents=B||0}).prototype={toString:function(){return h.formatCurrency(this.dollars())},cents:function(B){if(B===undefined){return this._cents}return new h.Cost(B)},dollars:function(B){if(B===undefined){return this._cents/100}return new h.Cost(B*100)},mult:function(B){return new h.Cost(this._cents*B)},add:function(B){if(B.cents){B=B.cents()}return new h.Cost(this._cents+B)},sub:function(B){if(B.cents){B=B.cents()}return new h.Cost(this._cents-B)}};h.Cost.FREE=new h.Cost(0);(h.TimePeriod=function(C,B){this.length=C;this.unit=B}).prototype={toString:function(){return""+t(this.length,this.unit)},toDate:function(){var B=new Date();switch(this.unit){case"month":B.setMonth(B.getMonth()+this.length);break;case"day":B.setDay(B.getDay()+this.length);break}return B},clone:function(){return new h.TimePeriod(this.length,this.unit)}};(h.RecurringCost=function(C,B){this.cost=C;this.interval=B}).prototype={toString:function(){return""+this.cost+" every "+this.interval},clone:function(){return new h.TimePeriod(this.length,this.unit)}};h.RecurringCost.FREE=new h.RecurringCost(0,null);(h.RecurringCostStage=function(B,C){this.recurringCost=B;this.duration=C}).prototype={toString:function(){this.recurringCost.toString()+" for "+this.duration.toString()}};h.locale={};h.locale.errors={emptyField:"Required field",missingFullAddress:"Please enter your full address.",invalidEmail:"Invalid",invalidCC:"Invalid",invalidCVV:"Invalid",invalidCoupon:"Invalid",cardDeclined:"Transaction declined",acceptTOS:"Please accept the Terms of Service.",invalidQuantity:"Invalid quantity"};h.locale.currencies={};h.locale.currency={format:"%u%n",separator:".",delimiter:",",precision:2};function r(B,C){var E=h.locale.currencies[B]=u(h.locale.currency);for(var D in C){E[D]=C[D]}}r("USD",{symbol:"$"});r("AUD",{symbol:"$"});r("CAD",{symbol:"$"});r("EUR",{symbol:"\u20ac"});r("GBP",{symbol:"\u00a3"});r("CZK",{symbol:"\u004b"});r("DKK",{symbol:"\u006b\u0072"});r("HUF",{symbol:"Ft"});r("JPY",{symbol:"\u00a5"});r("NOK",{symbol:"kr"});r("NZD",{symbol:"$"});r("PLN",{symbol:"\u007a"});r("SGD",{symbol:"$"});r("SEK",{symbol:"kr"});r("CHF",{symbol:"Fr"});r("ZAR",{symbol:"R"});h.settings.locale=h.locale;h.knownCards={visa:{prefixes:[4],name:"Visa"},mastercard:{prefixes:[51,52,53,54,55],name:"MasterCard"},american_express:{prefixes:[34,37],name:"American Express"},discover:{prefixes:[6011,62,64,65],name:"Discover"},diners_club:{prefixes:[305,36,38],name:"Diners Club"},carte_blanche:{prefixes:[300,301,302,303,304,305]},jcb:{prefixes:[35],name:"JCB"},enroute:{prefixes:[2014,2149],name:"EnRoute"},maestro:{prefixes:[5018,5020,5038,6304,6759,6761],name:"Maestro"},laser:{prefixes:[6304,6706,6771,6709],name:"Laser"}};h.detectCardType=function(D){D=D.replace(/\D/g,"");var G=h.knownCards;for(var B in G){if(G.hasOwnProperty(B)){var H=G[B];for(var F=0,C=H.prefixes.length;F<C;++F){if(H.prefixes.hasOwnProperty(F)){var E=H.prefixes[F];if(new RegExp("^"+E.toString()).test(D)){return B}}}}}return false};h.formatCurrency=function(E,I){if(E<0){E=-E;var D=true}else{var D=false}I=I||h.settings.currency||h.raiseError("currency not configured");var H=h.locale.currency;var C=h.locale.currencies[I];var G=E.toFixed(C.precision);if(H.separator!="."){G=G.replace(/\./g,H.separator)}function B(K){var J=new RegExp("(-?[0-9]+)([0-9]{3})");while(J.test(K)){K=K.replace(J,"$1"+H.delimiter+"$2")}return K}G=B(G);var F=H.format;F=F.replace(/%u/g,C.symbol);F=F.replace(/%n/g,G);G=F;if(D){G="-"+G}return G};var m=["AT","BE","BG","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","GB"];h.isCountryInEU=function(B){return f.inArray(B,m)!==-1};h.isVATNumberApplicable=function(C,B){if(!h.settings.VATPercent){return false}if(!h.settings.country){h.raiseError("you must configure a country for VAT to work")}if(!h.isCountryInEU(h.settings.country)){h.raiseError("you cannot charge VAT outside of the EU")}if(!h.isCountryInEU(C)){return false}return true};h.isVATChargeApplicable=function(C,D){if(!h.isVATNumberApplicable(C)){return false}var B=h.settings.country;return(B==C||!D)};h.flattenErrors=function(H,C){var B=[];var C=C||"";if(typeof H=="string"||typeof H=="number"||typeof H=="boolean"){if(C=="base"){return[H]}return[""+C+" "+H]}for(var E in H){if(H.hasOwnProperty(E)){C=(parseInt(E).toString()==E)?C:E;var G=h.flattenErrors(H[E],C);for(var F=0,D=G.length;F<D;++F){B.push(G[F])}}}return B};h.getToken=function(B){var C=B.token||"INVALIDTOKEN";return C};h.postResult=function(C,F,B){var D=h.getToken(F);var E=f("<form />").hide();E.attr("action",C).attr("method","POST").attr("enctype","application/x-www-form-urlencoded");f('<input type="hidden" />').attr({name:"recurly_token",value:D}).appendTo(E);f("body").append(E);E.submit()};function k(E){var D=f("<select>");for(var C in E){if(E.hasOwnProperty(C)){var B=E[C];D.append("<option value="+C+">"+B+"</option>")}}return D}h.enforce=function(B){return{enforced:B,hidden:false,hide:function(){this.hidden=true;return this}}};function q(C){C=C||this;if(typeof C=="string"){return C.replace(/([a-z])([A-Z])/g,function(E,D,F){return D+"_"+F}).toLowerCase()}else{for(var B in C){if(C.hasOwnProperty(B)){}}}}h.ajax=function(B){B.data=f.extend({js_version:h.version},B.data);return f.ajax(B)};function v(B){f("body").append(h.dom.error_dialog)}(h.isValidCC=function(H){var C=H.val();C=C.replace(/\D/g,"");if(C==""){return false}var F=0,E=0,B=false;for(var G=C.length-1;G>=0;G--){var D=C.charAt(G);var E=parseInt(D,10);if(B){if((E*=2)>9){E-=9}}F+=E;B=!B}return(F%10)==0}).defaultErrorKey="invalidCC";(h.isValidEmail=function(C){var B=C.val();return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(B)}).defaultErrorKey="invalidEmail";function b(B){return/^[0-9]+$/.test(B)}(h.isValidCVV=function(C){var B=C.val();return(B.length==3||B.length==4)&&b(B)}).defaultErrorKey="invalidCVV";(h.isNotEmpty=function(C){var B=C.val();if(C.is("select")){if(B=="-"||B=="--"){return false}}return !!B}).defaultErrorKey="emptyField";(h.isNotEmptyState=function(C){var B=C.val();if(C.is("select")){if(B=="-"||B=="--"){return false}}return true}).defaultErrorKey="emptyField";(h.isChecked=function(B){return B.is(":checked")}).defaultErrorKey="acceptTOS";(h.isValidQuantity=function(B){return/^[0-9]*$/.test(B.val())}).defaultErrorKey="invalidQuantity";h.Plan={create:u,fromJSON:function(E){var F=this.create();F.name=E.name;F.code=E.plan_code;F.currency=E.currency;F.cost=new h.Cost(E.unit_amount_in_cents);F.displayQuantity=E.display_quantity;F.interval=new h.TimePeriod(E.plan_interval_length,E.plan_interval_unit);if(E.trial_interval_length){F.trial=new h.TimePeriod(E.trial_interval_length,E.trial_interval_unit)}if(E.setup_fee_in_cents){F.setupFee=new h.Cost(E.setup_fee_in_cents)}if(E.vat_percentage){h.settings.VATPercent=parseFloat(E.vat_percentage)}if(E.merchant_country){h.settings.country=E.merchant_country}F.addOns=[];if(E.add_ons){for(var C=E.add_ons.length,D=0;D<C;++D){var B=E.add_ons[D];F.addOns.push(h.AddOn.fromJSON(B))}}return F},get:function(C,B,D){f.ajax({url:h.settings.baseURL+"plans/"+C+"?currency="+B,dataType:"jsonp",jsonp:"callback",timeout:10000,success:function(E){var F=h.Plan.fromJSON(E);D(F)}})},createSubscription:function(){var B=u(h.Subscription);B.plan=u(this);B.plan.quantity=1;B.addOns=[];return B}};h.AddOn={fromJSON:function(C){var B=u(h.AddOn);B.name=C.name;B.code=C.add_on_code;B.cost=new h.Cost(C.default_unit_amount_in_cents);B.displayQuantity=C.display_quantity;return B},toJSON:function(){return{name:this.name,add_on_code:this.code,default_unit_amount_in_cents:this.default_unit_amount_in_cents}}};h.Account={create:u,toJSON:function(){return{first_name:this.firstName,last_name:this.lastName,company_name:this.companyName,account_code:this.code,email:this.email,username:this.username}}};h.BillingInfo={create:u,toJSON:function(){return{first_name:this.firstName,last_name:this.lastName,month:this.month,year:this.year,number:this.number,verification_value:this.cvv,address1:this.address1,address2:this.address2,city:this.city,state:this.state,zip:this.zip,country:this.country,phone:this.phone,vat_number:this.vatNumber}},save:function(B){var C={billing_info:this.toJSON(),signature:B.signature};if(!B.distinguishContactFromBillingInfo){C.account={account_code:B.accountCode,first_name:this.firstName,last_name:this.lastName}}h.ajax({url:h.settings.baseURL+"accounts/"+B.accountCode+"/billing_info/update",data:C,dataType:"jsonp",jsonp:"callback",timeout:60000,success:function(D){if(D.success&&B.success){B.success(D.success)}else{if(D.errors&&B.error){B.error(h.flattenErrors(D.errors))}}},error:function(){if(B.error){B.error(["Unknown error processing transaction. Please try again later."])}},complete:B.complete||f.noop})}};h.Subscription={create:u,plan:h.Plan,addOns:[],calculateTotals:function(){var E={stages:{}};E.plan=this.plan.cost.mult(this.plan.quantity);E.allAddOns=new h.Cost(0);E.addOns={};for(var C=this.addOns.length,D=0;D<C;++D){var B=this.addOns[D],I=B.cost.mult(B.quantity);E.addOns[B.code]=I;E.allAddOns=E.allAddOns.add(I)}E.stages.recurring=E.plan.add(E.allAddOns);E.stages.now=E.plan.add(E.allAddOns);if(this.plan.trial){E.stages.now=h.Cost.FREE}if(this.plan.setupFee){E.stages.now=E.stages.now.add(this.plan.setupFee)}if(this.coupon){var F=E.stages.now;var H;if(this.coupon.discountFixed){H=this.coupon.discountFixed}else{H=F.sub(this.plan.setupFee||0).mult(this.coupon.discountRatio)}var G=F.sub(H);if(G.cents()<0){G=h.Cost.FREE}E.coupon=G.sub(F);E.stages.now=G}if(this.billingInfo&&h.isVATChargeApplicable(this.billingInfo.country,this.billingInfo.vatNumber)){E.vat=E.stages.now.mult((h.settings.VATPercent/100));E.stages.now=E.stages.now.add(E.vat)}return E},redeemAddOn:function(C){var B=C.createRedemption();this.addOns.push(B);return B},removeAddOn:function(E){for(var C=this.addOns,B=C.length,D=0;D<B;++D){if(C[D].code==E){return C.splice(D,1)}}},findAddOnByCode:function(D){for(var B=this.addOns.length,C=0;C<B;++C){if(this.addOns[C].code==D){return this.addOns[C]}}return false},toJSON:function(){var F={plan_code:this.plan.code,quantity:this.plan.quantity,currency:this.plan.currency,coupon_code:this.coupon?this.coupon.code:undefined,add_ons:[]};for(var E=0,D=this.addOns.length,C=F.add_ons,B=this.addOns;E<D;++E){C.push({add_on_code:B[E].code,quantity:B[E].quantity})}return F},save:function(B){var C={subscription:this.toJSON(),account:this.account.toJSON(),billing_info:this.billingInfo.toJSON(),signature:B.signature};h.ajax({url:h.settings.baseURL+"subscribe",data:C,dataType:"jsonp",jsonp:"callback",timeout:60000,success:function(D){if(D.success&&B.success){B.success(D.success)}else{if(D.errors&&B.error){var E=D.errors.error_code;delete D.errors.error_code;B.error(h.flattenErrors(D.errors),E)}}},error:function(){if(B.error){B.error(["Unknown error processing transaction. Please try again later."])}},complete:B.complete})}};h.AddOn.createRedemption=function(C){var B=u(this);B.quantity=C||1;return B};h.Coupon={fromJSON:function(B){var C=u(h.Coupon);if(B.discount_in_cents){C.discountFixed=new h.Cost(B.discount_in_cents)}else{if(B.discount_percent){C.discountRatio=B.discount_percent/100}}C.description=B.description;return C},toJSON:function(){}};h.Subscription.getCoupon=function(D,B,C){if(!h.settings.baseURL){h.raiseError("Company subdomain not configured")}var E=(h.settings.currency!==undefined?"?currency="+h.settings.currency:"");return h.ajax({url:h.settings.baseURL+"plans/"+this.plan.code+"/coupons/"+D+E,dataType:"jsonp",jsonp:"callback",timeout:10000,success:function(G){if(G.valid){var F=h.Coupon.fromJSON(G);F.code=D;B(F)}else{C()}},error:function(){C()}})};h.Transaction={create:u,save:function(B){var C={account:this.account?this.account.toJSON():undefined,billing_info:this.billingInfo.toJSON(),signature:B.signature};h.ajax({url:h.settings.baseURL+"transactions/create",data:C,dataType:"jsonp",jsonp:"callback",timeout:60000,success:function(D){if(D.success&&B.success){B.success(D.success)}else{if(D.errors&&B.error){B.error(h.flattenErrors(D.errors))}}},error:function(){if(B.error){B.error(["Unknown error processing transaction. Please try again later."])}},complete:B.complete||f.noop})}};h.UserError={};function s(B,C){var D=u(h.UserError);D.validation=B;D.element=C;throw D}function w(F){var G=F.element;var E=h.locale.errors[F.validation.errorKey];var C=F.validation.validator;var B=f('<div class="error">');B.html("<span></span>"+E);B.appendTo(G.parent());G.parent().addClass("invalid");f("#err-mess").html('<div class="show-error"><img src="images/errbig.png" /> <span class="red-err"><span id="num-err"></span> Errors Remain.</span> Please address to continue.</div>');f("#num-err").html(f(".invalid").length);G.bind("change keyup",function D(H){if(C(G)){G.parent().removeClass("invalid");B.remove();G.unbind(H);f("#num-err").html(f(".invalid").length);if(f(".invalid").length<1){f("#err-mess").html("")}}})}function A(D,F){var C=false;var B={field:function(G,I,H){H=Array.prototype.slice.call(arguments,2);return y(G,I,H,function J(K){if(!C){K.element.focus()}w(K);C=true;if(h.settings.oneErrorPerForm){throw {stopPulling:true}}})}};try{D(B)}catch(E){if(!E.stopPulling){throw E}}if(!C){F()}}function y(J,E,C,G){var H=J.find(E+" input");if(H.length==0){H=J.find(E+" select")}if(H.length==0){return undefined}var B=H.val();for(var F=0,D=C.length;F<D;++F){var I=C[F];if(!I.validator(H)){G({element:H,validation:I});if(h.settings.oneErrorPerField){break}}}return B}function c(C,B){return{validator:C,errorKey:B||C.defaultErrorKey}}function a(B){var C=B.find(".server_errors");C.removeClass("any").addClass("none");C.empty()}function o(C,G){var E=C.find(".server_errors");a(C);var B=G.length;if(B){E.removeClass("none").addClass("any");for(var F=0;F<B;++F){var D=f('<div class="error">');D.text(G[F]);E.append(D)}}}var j={account:{firstName:".contact_info > .full_name > .first_name > input",lastName:".contact_info > .full_name > .last_name > input",username:".contact_info > .username > input",email:".billing_info > .email > input",phone:".contact_info > .phone > input",companyName:".contact_info > .company_name > input"},billingInfo:{firstName:".contact_info > .first_name > input",lastName:".contact_info > .last_name > input",address1:".contact_info > .address1 > input",address2:".contact_info > .address2 > input",country:".billing_info > .address > .country > select",city:".contact_info > .city > input",state:".contact_info > .state > input",zip:".contact_info > .zip > input",vatNumber:".billing_info > .vat_number > input",cardNumber:".billing_info  .card_number > input",CVV:".billing_info  .cvv > input"},subscription:{couponCode:".subscription > .coupon > .coupon_code > input"}};function n(B,C,E){(function D(G,F,J){if(!G){return}for(var I in G){if(G.hasOwnProperty(I)&&F.hasOwnProperty(I)){var M=G[I];var H=F[I];var N=q(I);var K=J?(J+"."+N):N;if(typeof H=="string"){var L=B.find(H);L.val(M).change()}else{if(typeof H=="object"){D(M,H,K)}}}}})(C,E)}function l(B,C){if(!C.collectPhone){B.find(".phone").remove()}if(!C.collectCompany){B.find(".company_name").remove()}B.delegate(".placeholder","click",function(){var D=f(this);var E=f(this).parent();E.find("input").focus()});B.delegate("input","change keyup",function(){var E=f(this);var D=f(this).parent();if(E.val().length>0){D.find(".placeholder").hide()}else{D.find(".placeholder").show()}});B.delegate("input","focus",function(){f(this).parent().addClass("focus")});B.delegate("input","blur",function(){f(this).parent().removeClass("focus")});B.delegate("input","keydown",function(D){if(D.keyCode>=48&&D.keyCode<=90){f(this).parent().find(".placeholder").hide()}});n(B,C,j)}function g(D,E){if(E.distinguishContactFromBillingInfo){var C=D.find(".contact_info .first_name input");var F=D.find(".contact_info .last_name input");var G=C.val();var B=F.val();D.find(".contact_info .first_name input").change(function(){var H=D.find(".billing_info .first_name input");if(H.val()==G){H.val(f(this).val()).change()}G=C.val()});D.find(".contact_info .last_name input").change(function(){var H=D.find(".billing_info .last_name input");if(H.val()==B){H.val(f(this).val()).change()}B=F.val()})}else{D.find(".billing_info .first_name, .billing_info .last_name").remove()}}function e(J,F){var C=J.find(".country select");var W=J.find(".state");var aa=W.find("input");var R=W.children();var N={};var L=h.states;var K=C.val();function P(ag,ae){var af=L[ag];ae=f.trim(ae.toUpperCase());if(af.hasOwnProperty(ae)){return ae}for(var ad in af){if(af.hasOwnProperty(ad)){var ac=af[ad];if(ae==ac.toUpperCase()){return ad}}}return false}function ab(af,ac){var ae=W.hasClass("select_mode");if(af=="US"||af=="CA"){if(!ae||K!=af){var ad=W.find("input").val();if(ad!=undefined&&ad!=""){ac=P(af,ad);if(!ac){return false}}W.addClass("select_mode");W.children().detach();N[af]=N[af]||k(L[af]);W.append(N[af]);if(ac){W.find("select").val(ac)}}}else{if(ae){W.empty().append(R).removeClass("select_mode")}}}aa.bind("change keyup",function(){ab(K)});C.change(function(){var ac=f(this).val();ab(ac);K=ac});function H(ae,ac){var ad=ae.val();if(!ac||ac==""){return false}if(ad&&ad!=""&&ad!="-"){return false}return ae.val(ac).change()}if(F.enableGeoIP){f.ajax({url:h.settings.baseURL+"location",dataType:"jsonp",jsonp:"callback",success:function(ac){if(ac.country){H(C,ac.country);ab(ac.country,ac.state)}}})}else{if(h.settings.country){var T=J.find(".country option[value="+h.settings.country+"]");if(T.length){T.attr("selected",true).change()}}}var E=new Date();var M=E.getFullYear();var X=E.getMonth();var V=J.find(".year select");var B=J.find(".month select");for(var S=M;S<=M+10;++S){var G=f('<option name="'+S+'">'+S+"</option>");G.appendTo(V)}V.val(M+1);function U(){if(V.val()==M){var ac=false;if(B.val()>X){ac=true}B.find("option").each(function(){if(f(this).val()<=X){f(this).attr("disabled",true)}else{f(this).removeAttr("disabled");if(!ac){f(this).attr("selected",true);ac=true}}})}else{B.find("option").removeAttr("disabled")}}U();V.change(U);if(F.addressRequirement=="none"){J.find(".address").remove()}else{if(F.addressRequirement=="zip"){J.find(".address").addClass("only_zip");J.find(".address1, .address2, .city, .state").remove();if(!h.settings.VATPercent){J.find(".country").remove()}}else{if(F.addressRequirement=="zipstreet"){J.find(".address").addClass("only_zipstreet");J.find(".city, .state").remove();if(!h.settings.VATPercent){J.find(".country").remove()}}else{if(F.addressRequirement=="full"){J.find(".address").addClass("full")}}}}var O=J.find(".accepted_cards");if(F.acceptedCards){var Y=F.acceptedCards,Q=Y.length;for(var S=0;S<Q;++S){var Z=Y[S];var I=f('<div class="card '+Z+'">');var D=h.knownCards[Z];if(D&&D.name){I.text(D.name)}O.append(I)}}J.find(".card_number input").bind("change keyup",function(){var ac=h.detectCardType(f(this).val());if(ac){O.find(".card").each(function(){f(this).toggleClass("match",f(this).hasClass(ac));f(this).toggleClass("no_match",!f(this).hasClass(ac))})}else{O.find(".card").removeClass("match no_match")}})}function i(B,E,C,D){E.firstName=D.field(B,".contact_info .first_name",c(h.isNotEmpty));E.lastName=D.field(B,".contact_info .last_name",c(h.isNotEmpty));E.companyName=D.field(B,".contact_info .company_name",c(h.isNotEmpty));E.email=D.field(B,".email",c(h.isNotEmpty),c(h.isValidEmail));E.username=D.field(B,".contact_info .username");E.code=C.accountCode||(C.account&&(C.account.code||C.account.accountCode))}function d(B,E,C,D){E.firstName=D.field(B,".billing_info .first_name",c(h.isNotEmpty));E.lastName=D.field(B,".billing_info .last_name",c(h.isNotEmpty));E.number=D.field(B,".card_number",c(h.isNotEmpty),c(h.isValidCC));E.cvv=D.field(B,".cvv",c(h.isNotEmpty),c(h.isValidCVV));E.month=D.field(B,".month",c(h.isNotEmpty));E.year=D.field(B,".year",c(h.isNotEmpty));E.phone=D.field(B,".phone");E.address1=D.field(B,".address1",c(h.isNotEmpty));E.address2=D.field(B,".address2");E.city=D.field(B,".city",c(h.isNotEmpty));E.state=D.field(B,".state",c(h.isNotEmpty));E.zip=D.field(B,".zip",c(h.isNotEmpty));E.country=D.field(B,".country",c(h.isNotEmpty))}function p(B,E,C,D){var F=D.field(B,".plan .quantity",c(h.isValidQuantity));E.quantity=F||1}function x(B,C){C.field(B,".accept_tos",c(h.isChecked))}h.buildBillingInfoUpdateForm=function(C){var D={addressRequirement:"full",distinguishContactFromBillingInfo:true};C=f.extend(u(h.settings),D,C);if(!C.accountCode){h.raiseError("accountCode missing")}if(!C.signature){h.raiseError("signature missing")}var E=h.BillingInfo.create();var B=f(h.dom.update_billing_info_form);B.find(".billing_info").html(h.dom.billing_info_fields);l(B,C);e(B,C);B.submit(function(F){F.preventDefault();a(B);B.find(".error").remove();B.find(".invalid").removeClass("invalid");A(function(G){d(B,E,C,G)},function(){B.addClass("submitting");B.find("button.submit").attr("disabled",true).text("Please Wait");E.save({signature:C.signature,distinguishContactFromBillingInfo:C.distinguishContactFromBillingInfo,accountCode:C.accountCode,success:function(G){if(C.successHandler){C.successHandler(h.getToken(G))}if(C.successURL){var H=C.successURL;h.postResult(H,G,C)}},error:function(G){if(!C.onError||!C.onError(G)){o(B,G)}},complete:function(){B.removeClass("submitting");B.find("button.submit").removeAttr("disabled").text("Update")}})})});if(C.beforeInject){C.beforeInject(B.get(0))}f(function(){var F=f(C.target);F.html(B);if(C.afterInject){C.afterInject(B.get(0))}})};function z(B,C){if(C.termsOfServiceURL||C.privacyPolicyURL){var D=B.find(".accept_tos").html(h.dom.terms_of_service);if(!(C.termsOfServiceURL&&C.privacyPolicyURL)){D.find("span.and").remove()}if(C.termsOfServiceURL){D.find("a.tos_link").attr("href",C.termsOfServiceURL)}else{D.find("a.tos_link").remove()}if(C.privacyPolicyURL){D.find("a.pp_link").attr("href",C.privacyPolicyURL)}else{D.find("a.pp_link").remove()}}else{B.find(".accept_tos").remove()}}h.buildTransactionForm=function(C){var E={addressRequirement:"full",distinguishContactFromBillingInfo:true,collectContactInfo:true};C=f.extend(u(h.settings),E,C);if(!C.collectContactInfo&&!C.accountCode){h.raiseError("collectContactInfo is false, but no accountCode provided")}if(!C.signature){h.raiseError("signature missing")}var G=h.BillingInfo.create(),D=h.Account.create(),F=h.Transaction.create();F.account=D;F.billingInfo=G;F.currency=C.currency;F.cost=new h.Cost(C.amountInCents);var B=f(h.dom.one_time_transaction_form);B.find(".billing_info").html(h.dom.billing_info_fields);if(C.collectContactInfo){B.find(".contact_info").html(h.dom.contact_info_fields)}else{B.find(".contact_info").remove()}l(B,C);g(B,C);e(B,C);z(B,C);B.submit(function(H){H.preventDefault();a(B);B.find(".error").remove();B.find(".invalid").removeClass("invalid");A(function(I){i(B,D,C,I);d(B,G,C,I);x(B,I)},function(){B.addClass("submitting");B.find("button.submit").attr("disabled",true).text("Please Wait");F.save({signature:C.signature,accountCode:C.accountCode,success:function(I){if(C.successHandler){C.successHandler(h.getToken(I))}if(C.successURL){var J=C.successURL;h.postResult(J,I,C)}},error:function(I){if(!C.onError||!C.onError(I)){o(B,I)}},complete:function(){B.removeClass("submitting");B.find("button.submit").removeAttr("disabled").text("Pay")}})})});if(C.beforeInject){C.beforeInject(B.get(0))}f(function(){var H=f(C.target);H.html(B);if(C.afterInject){C.afterInject(B.get(0))}})};h.buildSubscriptionForm=function(C){var E={enableAddOns:true,enableCoupons:true,addressRequirement:"full",distinguishContactFromBillingInfo:false};C=f.extend(u(h.settings),E,C);if(!C.signature){h.raiseError("signature missing")}var B=f(h.dom.subscribe_form);B.find(".contact_info").html(h.dom.contact_info_fields);B.find(".billing_info").html(h.dom.billing_info_fields);if(C.planCode){h.Plan.get(C.planCode,C.currency,D)}else{if(C.plan){D(C.plan)}}l(B,C);g(B,C);e(B,C);z(B,C);function D(F){if(C.filterPlan){F=C.filterPlan(F)||F}var V=F.createSubscription(),H=h.Account.create(),O=h.BillingInfo.create();V.account=H;V.billingInfo=O;if(C.filterSubscription){V=C.filterSubscription(V)||V}if(!F.displayQuantity){B.find(".plan .quantity").remove()}if(F.setupFee){B.find(".subscription").addClass("with_setup_fee");B.find(".plan .setup_fee .cost").text(" + "+F.setupFee)}else{B.find(".plan .setup_fee").remove()}if(F.trial){B.find(".subscription").addClass("with_trial");B.find(".plan .free_trial").text("First "+F.trial+" free")}else{B.find(".plan .free_trial").remove()}function M(){var Y=V.calculateTotals();B.find(".plan .recurring_cost .cost").text(""+Y.plan);B.find(".due_now .cost").text(""+Y.stages.now);B.find(".coupon .discount").text(""+(Y.coupon||""));B.find(".vat .cost").text(""+(Y.vat||""));B.find(".add_ons .add_on").each(function(){var Z=f(this).data("add_on");if(f(this).hasClass("selected")){var aa=Y.addOns[Z.code];f(this).find(".cost").text("+ "+aa)}else{f(this).find(".cost").text("+ "+Z.cost)}})}B.find(".plan .quantity input").bind("change keyup",function(){V.plan.quantity=parseInt(f(this).val(),10)||1;M()});B.find(".plan .name").text(F.name);B.find(".plan .recurring_cost .cost").text(""+F.cost);B.find(".plan .recurring_cost .interval").text("every "+F.interval);var G=F.cost+" / "+F.interval;if(F.setupFee){G+=" + "+F.setupFee+" setup fee"}B.find(".planDetails").text(G);var K=B.find(".add_ons");if(C.enableAddOns){var S=F.addOns.length;if(S){K.removeClass("none").addClass("any");for(var T=0;T<S;++T){var Q=F.addOns[T];var U="add_on add_on_"+Q.code+(T%2?" even":" odd");if(T==0){U+=" first"}if(T==S-1){U+=" last"}var J=f('<div class="'+U+'"><div class="name">'+Q.name+'</div><div class="field quantity"><div class="placeholder">Qty</div><input type="text"></div><div class="cost"/></div>');if(!Q.displayQuantity){J.find(".quantity").remove()}J.data("add_on",Q);J.appendTo(K)}K.delegate(".quantity input","change keyup",function(ab){var Y=f(this).closest(".add_on");var aa=Y.data("add_on");var Z=parseInt(f(this).val(),10)||1;V.findAddOnByCode(aa.code).quantity=Z;M()});K.bind("selectstart",function(Y){if(f(Y.target).is(".add_on")){Y.preventDefault()}});K.delegate(".add_on","click",function(ac){if(f(ac.target).closest(".quantity").length){return}var aa=!f(this).hasClass("selected");f(this).toggleClass("selected",aa);var ab=f(this).data("add_on");if(aa){var Y=V.redeemAddOn(ab);var Z=f(this).find(".quantity input");Y.quantity=parseInt(Z.val(),10)||1;Z.focus()}else{V.removeAddOn(ab.code)}M()})}}else{K.remove()}var N=B.find(".coupon");var R=null;function W(){var Y=N.find("input").val();if(Y==R){return}R=Y;if(!Y){N.removeClass("invalid").removeClass("valid");N.find(".description").text("");V.coupon=undefined;M();return}N.addClass("checking");V.getCoupon(Y,function(Z){N.removeClass("checking");V.coupon=Z;N.removeClass("invalid").addClass("valid");N.find(".description").text(Z.description);M()},function(){V.coupon=undefined;N.removeClass("checking");N.removeClass("valid").addClass("invalid");N.find(".description").text(h.locale.errors.invalidCoupon);M()})}if(C.enableCoupons){N.find("input").bind("keyup change",function(Y){});N.find("input").keypress(function(Y){if(Y.charCode==13){Y.preventDefault();W()}});N.find(".check").click(function(){W()});N.find("input").blur(function(){N.find(".check").click()})}else{N.remove()}var I=B.find(".vat");var X=B.find(".vat_number");var P=X.find("input");I.find(".title").text("VAT at "+h.settings.VATPercent+"%");function L(){var Z=B.find(".country select").val();var ab=h.isVATNumberApplicable(Z);X.toggleClass("applicable",ab);X.toggleClass("inapplicable",!ab);var aa=P.val();var Y=h.isVATChargeApplicable(Z,aa);I.toggleClass("applicable",Y);I.toggleClass("inapplicable",!Y)}B.find(".country select").change(function(){O.country=f(this).val();M();L()}).change();P.bind("keyup change",function(){O.vatNumber=f(this).val();M();L()});B.submit(function(Y){Y.preventDefault();a(B);B.find(".error").remove();B.find(".invalid").removeClass("invalid");A(function(Z){p(B,V.plan,C,Z);i(B,H,C,Z);d(B,O,C,Z);x(B,Z)},function(){B.addClass("submitting");B.find("button.submit").attr("disabled",true).text("Please Wait");var Z=B.find(".email input");f.post("/registration/validate",{email:Z.val()},function(aa){var ab=f.parseJSON(aa);if(ab.status=="success"){V.save({signature:C.signature,success:function(ac){if(C.successHandler){C.successHandler(h.getToken(ac))}if(C.successURL){var ad=C.successURL;h.postResult(ad,ac,C)}},error:function(ac){if(!C.onError||!C.onError(ac)){o(B,ac)}},complete:function(){B.removeClass("submitting");B.find("button.submit").removeAttr("disabled").text(prevText)}})}else{o(B,ab.errors)}})})});M();if(C.beforeInject){C.beforeInject(B.get(0))}f(function(){var Y=f(C.target);Y.html(B);if(C.afterInject){C.afterInject(B.get(0))}})}};h.states={};h.states.US={"-":"Select State","--":"------------",AK:"Alaska",AL:"Alabama",AP:"Armed Forces Pacific",AR:"Arkansas",AS:"American Samoa",AZ:"Arizona",CA:"California",CO:"Colorado",CT:"Connecticut",DC:"District of Columbia",DE:"Delaware",FL:"Florida",FM:"Federated States of Micronesia",GA:"Georgia",GU:"Guam",HI:"Hawaii",IA:"Iowa",ID:"Idaho",IL:"Illinois",IN:"Indiana",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",MA:"Massachusetts",MD:"Maryland",ME:"Maine",MH:"Marshall Islands",MI:"Michigan",MN:"Minnesota",MO:"Missouri",MP:"Northern Mariana Islands",MS:"Mississippi",MT:"Montana",NC:"North Carolina",ND:"North Dakota",NE:"Nebraska",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NV:"Nevada",NY:"New York",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",PR:"Puerto Rico",PW:"Palau",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VA:"Virginia",VI:"Virgin Islands",VT:"Vermont",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"};h.states.CA={"-":"Select State","--":"------------",AB:"Alberta",BC:"British Columbia",MB:"Manitoba",NB:"New Brunswick",NL:"Newfoundland",NS:"Nova Scotia",NU:"Nunavut",ON:"Ontario",PE:"Prince Edward Island",QC:"Quebec",SK:"Saskatchewan",NT:"Northwest Territories",YT:"Yukon Territory",AA:"Armed Forces Americas",AE:"Armed Forces Europe, Middle East, &amp; Canada"};h.dom.contact_info_fields='<span class="label">Billing Information</span><div class="field country"><input type="hidden" value="US"/></div><div class="field username"><input type="hidden"/></div><p class="txt field company_name"><input type="text" placeholder="Business Name"/></p><p class="txt field first_name"><input type="text" placeholder="First Name"/></p><p class="txt field last_name"><input type="text" placeholder="Last Name"/></p>';h.dom.billing_info_fields='<span class="label">Credit or debit card</span><p class="txt cc field card_number"><input type="text" placeholder="Card Number"/></p><div class="field expires"><span class="label">Expiration</span><span class="txt month"><input type="text" placeholder="MM"/></span><span class="txt year"><input type="text" placeholder="YY"/></span><span class="label">Security Code<span class="txt field cvv cvc"><input type="text" placeholder="CVC"/></span></span></div><p class="label">Email</p><div class="txt field email"><input type="text" placeholder="Email"/></div>';h.dom.subscribe_form='<form class="recurly subscribe"><div class="reg-title plan"><h2>Create Your<strong>QualityMedia</strong>Account</h2><h4><strong class="planDetails"></strong></h4></div><div class="reg-bd clearfix"><div class="server_errors none"></div><div class="left fieldset"><div class="contact_info"></div></div><div class="right fieldset"><div class="billing_info"></div></div></div><div class="reg-ft"><div class="accept_tos"></div><span class="btn"><input type="Submit" value="Submit"/></span></div></form>';h.dom.update_billing_info_form='<form class="recurly update_billing_info"><div class="server_errors none"></div><div class="billing_info"></div><div class="footer"><button type="submit" class="submit">Update</button></div></form>';h.dom.one_time_transaction_form='<form class="recurly update_billing_info"><div class="server_errors none"></div><div class="contact_info"></div><div class="billing_info"></div><div class="accept_tos"></div><div class="footer"><button type="submit" class="submit">Pay</button></div></form>';h.dom.terms_of_service='<p><input type="checkbox" class="chbox"/>By typing your full name above, you authorize <strong>QualityMedia</strong> to bill your credit card as stated in the <a target="_blank" class="tos_link agree agreement-page">agreement</a>.</p>';window.Recurly=h})(jQuery);